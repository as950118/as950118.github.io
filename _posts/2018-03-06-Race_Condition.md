---
layout:default
tags:LinuxUnix
title:Race_Condition
---

# Rae Condition을 이용한 해킹 기법

## Race Condition이란?

두 프로세스 간에 리소스를 사용하기 위해 다투는 과정입니다.

먼저 아래 코드를 보도록 하겠습니다.

```{c}
#include<stdio.h>

void main(void){
	int childpid;
    static int a;
    
    if((childpid = fork()) > 0){
    	for(a; a<100; a++){
        	if(a%2 == 0){
            	printf("O");
            }
        }
        exit(0);
    }
    else{
    	for(a; a<100; a++){
        	if(a%2 == 1){
            	printf("X");
            }
        }
        exit(0);
    }
}
```

fork()란 동일한 작업을 하는 프로세스를 하나 더 실행하는 함수입니다.

논리적으로는 O와 X가 한번씩 나와 OXOXOX..가 50번 출력되어야 할 것입니다.

하지만 실제로는 OOXXOXX..와 같이 출력될 것입니다.

이것이 바로 경쟁조건, 즉 Race Condition의 결과입니다.

지금 당장은 이것을 이용한 어떠한 해킹기법이 있을지 생각하긴 힘들 것 입니다.

그럼 그에 앞서 Symbolic Link에 대해 알아보도록 하겠습니다.

## Symbolic Link

심볼릭 링크란 쉽게 말해 윈도우에서의 바로가기라고 생각하시면 됩니다.

그리고 또한 하드링크라는 것이 있는데 이것은 윈도우에서의 복사파일이라고 생각하시면 됩니다.

생성법은 ln -s file path 를 입력하시면 됩니다.

이러한 심볼릭 링크에는 문제점이 존재합니다.

간단한 예를 들어보겠습니다.

elm의 autoreplay라는 함수가 있습니다.

이 함수는 /tmp에 SETUID(관리자 솟유)인 arep 이라는 파일을 생성합니다.

하지만 이 arep이라는 파일을 없애고 심볼릭 링크를 /.rhosts로 연결시키고

/.rhosts 파일에 "+ +"을 입력하면

모든 시스템에서 관리자 권한으로 접속 할 수 있게 됩니다.

## 문제점

위의 심볼릭 링크 문제에 대한 해결방법은 lstat 함수를 이용해 먼저 파일의 상태를 검사한 후

open 함수를 통해 처리하도록 하는 것 입니다.

그리고 이 lstat과 open 두 함수의 실행 간의 시차를 이용한 것이 바로 경쟁조건을 이용한 해킹 기법입니다.

## 방어

가장 기본적인 대전제는 시차를 주지 않는 것입니다.

그러기 위해선 먼저 되도록 임시파일을 만들지 않아야 합니다.

임시 파일을 만드는 것은 경쟁 조건의 원인이 되기 쉽습니다.

또한 만약 파일을 생성할 경우에는 먼저 해당 파일이 존재하는지 여부를 검사해야합니다.

물론 가장 근본적이고 쉬운 방법은 SecureOS를 사용하는 것입니다.

하지만 개인이 사용하기엔 가격에서부터 무리가 있습니다.

## 결론

보안은 어렵다.